# Sprint 0 - Updated Priority & Verification Plan

**Date:** 2025-11-26  
**Updated by:** HC feedback  
**Critical Change:** Environment setup is now BLOCKING Task #1

---

## Key Changes from HC Feedback

### 1. âœ… Use UV Instead of PIP

**Decision:** Replace all `pip` usage with `uv` (10-100x faster)

**Implementation:**
- Nix flake provides `pkgs.uv`
- `shellHook` uses `uv venv` and `uv pip install`
- Manual setup installs `uv` first
- All documentation updated to show `uv pip` commands

**Benefits:**
- 10-100x faster dependency installation
- Better dependency resolution
- Smart caching
- Drop-in replacement (`uv pip install` works like `pip install`)

---

### 2. ğŸ”´ Environment Setup is Now Sprint 0 Task #1 (BLOCKING)

**Critical Change:** No other Sprint 0 work begins until environment setup is 100% verified.

**Why:**
- Must work perfectly on all platforms (Windows, WSL2, macOS, Linux)
- Both Nix and manual setups must be tested
- Documentation must be clear and accurate
- Prevents wasted effort if environment is broken

---

### 3. âœ… Manual Setup Must Work (Windows Support)

**Requirement:** Developers who don't want Nix or use Windows must have working setup.

**Implementation:**
- Complete manual setup guide for Windows (PowerShell)
- Complete manual setup guide for Linux/WSL2/macOS (without Nix)
- Both methods produce identical environments
- Both methods fully documented with troubleshooting

**HC will personally verify:**
- Windows setup (PowerShell)
- WSL2 setup (Ubuntu)

---

## Sprint 0 Task Restructure

### Old Structure (19 hours)

1. Mock IMAP/SMTP servers
2. Performance benchmarks
3. Security scanning
4. Test structure
5. CI pipeline
6. Nix flake
7. TDD docs

**Problem:** Environment setup was Task #6, could fail late.

---

### New Structure (29 hours with verification)

### ğŸ”´ Task #1: Environment Setup & Verification (BLOCKING)

**13 hours** - Must complete FIRST

**Subtasks:**
1. Create configs (flake.nix, .envrc, pyproject.toml) - 3h
2. Write documentation (setup guide, README) - 2h
3. Verify Nix on macOS + Linux - 2h
4. Verify Manual on Windows - 1h (HC)
5. Verify Manual on WSL2 - 1h (HC)
6. Verify Manual on Linux (no Nix) - 1h
7. Fix issues and iterate - 2h

**Success criteria:**
- âœ… HC: "Windows works perfectly"
- âœ… HC: "WSL2 works perfectly"
- âœ… Team: "macOS Nix works"
- âœ… Team: "Linux Nix works"
- âœ… Team: "Linux manual (no Nix) works"

**Deliverables:**
- Working `flake.nix` with uv
- Working `.envrc`
- Working `pyproject.toml`
- Complete `docs/environment-setup-guide.md`
- Updated `README.md`
- Verification reports from all platforms

---

### Tasks 2-7: Remaining Sprint 0 (16 hours)

**Only start AFTER Task #1 is 100% verified**

2. TDD infrastructure - 2h
3. Mock IMAP/SMTP - 4h
4. Test structure - 2h
5. Security scanning - 2h
6. Performance benchmarks - 3h
7. CI pipeline - 3h

---

## Verification Checklists

### Nix Setup Checklist (10 steps)

```bash
# Run in sequence, all must pass
1. direnv allow â†’ âœ… No errors
2. python --version â†’ âœ… Python 3.10.x
3. which python â†’ âœ… /nix/store/...
4. uv --version â†’ âœ… Shows version
5. python -c "import fastapi" â†’ âœ… No error
6. ruff --version â†’ âœ… Shows version
7. pytest --version â†’ âœ… Shows version
8. pytest tests/ -v â†’ âœ… Runs (or no tests)
9. source .venv/bin/activate â†’ âœ… Works
10. Clean + recreate â†’ âœ… Reproduces
```

### Manual Setup Checklist (Windows)

```powershell
# Run in sequence, all must pass
1. python --version â†’ âœ… 3.10+ 
2. python -m venv .venv â†’ âœ… Created
3. .\.venv\Scripts\Activate.ps1 â†’ âœ… Activated
4. uv --version â†’ âœ… Shows version
5. uv pip install -e ".[dev]" â†’ âœ… Installed
6. python -c "import fastapi" â†’ âœ… No error
7. ruff --version â†’ âœ… Shows version
8. pytest --version â†’ âœ… Shows version
9. pytest tests\ -v â†’ âœ… Runs
10. Clean + recreate â†’ âœ… Reproduces
```

### Manual Setup Checklist (Linux/WSL2)

```bash
# Run in sequence, all must pass
1. python3 --version â†’ âœ… 3.10+
2. python3 -m venv .venv â†’ âœ… Created
3. source .venv/bin/activate â†’ âœ… Activated
4. uv --version â†’ âœ… Shows version
5. uv pip install -e ".[dev]" â†’ âœ… Installed
6. python -c "import fastapi" â†’ âœ… No error
7. ruff --version â†’ âœ… Shows version
8. pytest --version â†’ âœ… Shows version
9. pytest tests/ -v â†’ âœ… Runs
10. Clean + recreate â†’ âœ… Reproduces
```

---

## Testing Assignments

| Platform | Tester | Checklist | Time |
|----------|--------|-----------|------|
| **macOS (Nix)** | Team member | Nix setup | 1h |
| **Linux (Nix)** | Team member | Nix setup | 1h |
| **Windows** | **HC** | Manual setup (PowerShell) | 1h |
| **WSL2** | **HC** | Manual setup (bash) | 1h |
| **Linux (no Nix)** | Team member | Manual setup | 1h |

**Total verification:** 5 hours (parallel)

---

## Documentation Deliverables

### New Document: `docs/environment-setup-guide.md`

**Sections:**
1. Overview (two methods: Nix vs Manual)
2. Method 1: Nix Flakes Setup
   - Prerequisites
   - Setup steps
   - Troubleshooting
   - Verification checklist
3. Method 2: Manual Setup (Windows)
   - Prerequisites
   - Setup steps (PowerShell)
   - Troubleshooting
   - Verification checklist
4. Method 2: Manual Setup (Linux/WSL2/macOS)
   - Prerequisites
   - Setup steps (bash)
   - Troubleshooting
   - Verification checklist
5. Why UV instead of PIP
6. Environment comparison (Nix vs Manual)
7. Daily development workflow

**Status:** âœ… Created

---

### Updated: `docs/development-practices.md`

**Changes:**
- Section 2: Nix flake now uses `uv` instead of `pip`
- Architecture decision: Hybrid Nix + venv with uv
- Updated `shellHook` to use `uv venv` and `uv pip install`

**Status:** âœ… Updated

---

### Updated: `docs/test-design-system.md`

**Changes:**
- Sprint 0 restructured with Task #1 as BLOCKING
- Total effort updated: 19h â†’ 29h (includes verification)
- Added verification success criteria
- Added references to new environment-setup-guide.md

**Status:** âœ… Updated

---

## Sprint 0 Timeline (Updated)

### Week 1, Days 1-2: Environment Setup (Task #1)

**Day 1:**
- Create flake.nix, .envrc, pyproject.toml
- Write environment-setup-guide.md
- Update README.md

**Day 2:**
- Test Nix on macOS/Linux (team)
- Test Manual on Windows (HC)
- Test Manual on WSL2 (HC)
- Test Manual on Linux no-Nix (team)
- Fix issues, iterate, re-verify

**Milestone:** âœ… All 5 platforms verified working

---

### Week 1, Days 3-4: Remaining Sprint 0 (Tasks 2-7)

**Day 3:**
- TDD infrastructure (2h)
- Mock IMAP/SMTP (4h)
- Test structure (2h)

**Day 4:**
- Security scanning (2h)
- Performance benchmarks (3h)
- CI pipeline (3h)

**Milestone:** âœ… Sprint 0 complete, ready for Epic 1

---

## Critical Path

```
Task #1 (Environment) â†’ BLOCKING â†’ All other tasks
    â†“
  13 hours
    â†“
  âœ… All platforms verified
    â†“
Tasks 2-7 (Infrastructure)
    â†“
  16 hours
    â†“
  âœ… Sprint 0 complete
    â†“
Epic 1 Implementation (TDD)
```

**Total Sprint 0:** ~29 hours (~3.5-4 days with verification)

**Critical:** Task #1 must be 100% before proceeding.

---

## Success Metrics

**Task #1 is DONE when:**

âœ… **All 5 verification checklists pass** (50 checks total)  
âœ… **HC confirms Windows + WSL2 work perfectly**  
âœ… **Team confirms macOS + Linux Nix work perfectly**  
âœ… **Team confirms Linux manual (no Nix) works**  
âœ… **Documentation is clear and complete**  
âœ… **Both Nix and Manual produce identical environments**

**Sprint 0 is DONE when:**

âœ… **Task #1 complete** (environment verified)  
âœ… **Tasks 2-7 complete** (infrastructure ready)  
âœ… **All documentation updated**  
âœ… **CI pipeline functional**  
âœ… **Ready to start Epic 1 with TDD**

---

## Files Created/Updated

### New Files:
- âœ… `docs/environment-setup-guide.md` - Complete setup guide for both methods
- âœ… `docs/.sprint-0-priority.md` - This file (summary of changes)
- âœ… `docs/.nix-architecture-decisions.md` - Design rationale
- âœ… `docs/.nix-quick-answers.txt` - Quick reference

### Updated Files:
- âœ… `docs/development-practices.md` - Section 2 (Nix with uv)
- âœ… `docs/test-design-system.md` - Sprint 0 restructured
- âœ… `docs/QUICK-SUMMARY-DEVELOPMENT-PRACTICES.md` - Added uv + verification notes

### To Be Created in Sprint 0 Task #1:
- â­ï¸ `flake.nix` - Nix configuration with uv
- â­ï¸ `.envrc` - direnv auto-activation
- â­ï¸ `pyproject.toml` - Project metadata
- â­ï¸ `.gitignore` - Ignore .venv, .direnv, etc.
- â­ï¸ `README.md` - Quick start guide

---

## HC Action Items

**Before Sprint 0 starts:**
- âœ… Review environment-setup-guide.md
- âœ… Confirm Windows/WSL2 testing plan

**During Sprint 0 Task #1:**
- â­ï¸ Test Windows setup (PowerShell) - 1 hour
- â­ï¸ Test WSL2 setup (Ubuntu) - 1 hour
- â­ï¸ Report any issues for fixing
- â­ï¸ Confirm: "Both setups work perfectly"

**After Task #1 complete:**
- â­ï¸ Approve continuation to Tasks 2-7
- â­ï¸ Use verified environment for development

---

## Summary

**Key Changes:**
1. âœ… UV replaces pip (10-100x faster)
2. ğŸ”´ Environment setup is now BLOCKING Task #1
3. âœ… Manual setup fully supported (Windows, WSL2, no-Nix)
4. âœ… Complete verification checklists (50 checks)
5. âœ… HC will personally verify Windows + WSL2

**Sprint 0 Updated:**
- Old: 19 hours (environment was Task #6)
- New: 29 hours (environment is Task #1 with full verification)

**Next Steps:**
1. Team reviews this plan
2. Start Sprint 0 Task #1 (environment setup)
3. HC verifies Windows/WSL2 (1-2 hours)
4. Team verifies macOS/Linux (1-2 hours)
5. Fix issues, iterate
6. Once verified â†’ proceed to Tasks 2-7
7. Sprint 0 complete â†’ Epic 1 begins with TDD

---

**Environment setup is now the foundation - must be perfect before building on it! ğŸš€**
